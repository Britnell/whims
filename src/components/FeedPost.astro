---
import { parseHTML } from "linkedom";
import { embedTedVideos, embedYoutubeVideos } from "../lib/content";

export interface Props {
  post: {
    slug: string;
    title: string;
    date: Date;
    categories: string[];
    tags: string[];
    content: string;
  };
}

const { post } = Astro.props;

const isPost = post.slug == Astro.params.slug;
console.log({ isPost });

const { document } = parseHTML(post.content);

document.querySelectorAll("img").forEach((img: any) => {
  const src = img.getAttribute("src");
  img.classList.add("post-img");
  if (src?.includes("/uploads/")) {
    const newPath = "/whims/img/" + src.split("/uploads/")[1];
    img.setAttribute("src", newPath);
  }
});

embedYoutubeVideos(document);

embedTedVideos(document);

const processedContent = document.toString();
---

<article class="mb-10" transition:name={post.slug}>
  <h2 class="text-2xl flex justify-between items-end mb-2 px-4">
    {
      !isPost ? (
        <a
          class="hover:underline"
          href={`/post/${post.slug}`}
          set:html={post.title}
        />
      ) : (
        <span set:html={post.title} class="s" />
      )
    }
    <span
      class="text-right text-gray-700 text-sm font-sans font-normal shrink-0"
    >
      {post.date.toDateString()}
    </span>
  </h2>
  <!-- post.categories -->
  <div class="x rounded-md overflow-hidden">
    <div
      class={"post-content  overflow-x-auto bg-white px-3 py-5 " +
        (isPost ? " " : "max-h-[calc(100vh-140px)]")}
      set:html={processedContent}
    />
  </div>
  <!-- <div class="flex justify-center gap-2 mt-4">
    {post.tags.map((tag) => <span class="px-1 bg-slate-300"> {tag}</span>)}
  </div> -->
</article>

<style>
  .post-img {
    width: 50%;
  }
</style>
